# Version 1.0 Backup & Restore Guide

**Date**: November 9, 2025
**Purpose**: Complete backup of working v1.0 before GPU acceleration implementation
**Status**: ‚úÖ Backup Complete

---

## üîñ Backup Snapshot Information

### Git Information
- **Commit Hash**: `61ea16d`
- **Branch**: `claude/ailive-code-review-011CUseJ8kG4zVw12eyx4BsZ`
- **Tag**: `v1.0-stable` (local tag, points to commit 61ea16d)
- **Commit Message**: "docs: add comprehensive GPU acceleration research and update README for v1.1"
- **Date**: November 9, 2025

### System State
- ‚úÖ App builds successfully
- ‚úÖ Model downloads and loads correctly (1-2 seconds)
- ‚úÖ Inference working: 7-8 tokens/second
- ‚úÖ Full conversation support (512 tokens)
- ‚úÖ No crashes or stability issues
- ‚úÖ User confirmed: "Working good üëç"

### Key Files Included in Backup

**Source Code**:
- `app/src/main/java/com/ailive/ai/llm/LLMManager.kt` - Core LLM manager
- `external/llama.cpp/examples/llama.android/llama/src/main/java/android/llama/cpp/LLamaAndroid.kt` - Android bindings (nlen=512)
- `external/llama.cpp/examples/llama.android/llama/src/main/cpp/CMakeLists.txt` - Build configuration
- `app/build.gradle.kts` - App build configuration

**Documentation**:
- `README.md` - Complete v1.0 documentation
- `BUILD_LOG.md` - All build fixes and history
- `VISION_IMPLEMENTATION_RESEARCH.md` - Vision research
- `COMPLETE_FEATURE_ROADMAP.md` - 22-feature roadmap
- `VERSION_ROLLOUT_PLAN.md` - Release schedule
- `GPU_ACCELERATION_RESEARCH.md` - GPU research (just added)

**Submodules**:
- `llama.cpp/` - Root submodule (upstream C++ source)
- `external/llama.cpp/examples/llama.android/` - Android wrapper (customized)

**Model**:
- Model: Qwen2-VL-2B-Instruct
- Format: GGUF (Q4_K_M quantization)
- Size: 940MB
- Location: App downloads from Hugging Face on first launch
- File: `qwen2.5-vl-2b-instruct-q4_k_m.gguf`
- Source: https://huggingface.co/Qwen/Qwen2-VL-2B-Instruct-GGUF

---

## üîÑ How to Restore v1.0 (If GPU Implementation Fails)

### Method 1: Using Git Tag (Recommended)

```bash
# Navigate to project directory
cd /home/user/AILive

# Check current status
git status

# Restore to v1.0-stable tag
git checkout v1.0-stable

# Verify you're at the correct commit
git log -n 1
# Should show: 61ea16d docs: add comprehensive GPU acceleration research...

# If you want to create a new branch from this point
git checkout -b restore-v1.0-$(date +%Y%m%d)

# Or go back to development branch
git checkout claude/ailive-code-review-011CUseJ8kG4zVw12eyx4BsZ
```

### Method 2: Using Commit Hash

```bash
# Restore to specific commit
git checkout 61ea16d

# Check the state
git log -n 1

# Create a new branch if needed
git checkout -b v1.0-restored
```

### Method 3: Hard Reset (If current branch is broken)

```bash
# CAUTION: This will discard ALL uncommitted changes
git status  # Check what will be lost
git stash   # Save current work if needed

# Hard reset to v1.0-stable
git reset --hard v1.0-stable

# Or reset to specific commit
git reset --hard 61ea16d

# Verify state
git log -n 1
git status  # Should show "nothing to commit, working tree clean"
```

### Method 4: Revert Recent Commits

```bash
# If you want to keep history but undo recent changes
git log --oneline -n 10  # See recent commits

# Revert specific commits (keeps history)
git revert <commit-hash>

# Or revert to v1.0-stable (creates new revert commits)
git revert --no-commit HEAD..v1.0-stable
git commit -m "Revert to v1.0-stable state"
```

---

## üß™ Verification After Restore

After restoring, verify the system is working:

### 1. Check Git State
```bash
git log -n 1
# Should show commit 61ea16d or v1.0-stable tag
```

### 2. Check Key Files
```bash
# Verify nlen=512 in LLamaAndroid.kt
grep "nlen: Int = 512" external/llama.cpp/examples/llama.android/llama/src/main/java/android/llama/cpp/LLamaAndroid.kt

# Verify CMakeLists.txt path
grep "add_subdirectory.*llama.cpp" external/llama.cpp/examples/llama.android/llama/src/main/cpp/CMakeLists.txt
```

### 3. Clean Build
```bash
# Clean all build artifacts
./gradlew clean

# Rebuild from scratch
./gradlew assembleDebug
```

### 4. Test on Device
```bash
# Install fresh build
adb install app/build/outputs/apk/debug/app-debug.apk

# Check logs
adb logcat | grep -E "LLamaAndroid|LLMManager"

# Expected logs:
# - "Loaded model [model path]"
# - Should see token generation
# - No crashes or errors
```

### 5. Functional Tests
- Launch app ‚úÖ
- Wait for model download (first launch) ‚úÖ
- Send test message: "Hello" ‚úÖ
- Verify response appears (not cut off) ‚úÖ
- Send longer prompt: "Tell me a joke" ‚úÖ
- Verify 40+ token responses work ‚úÖ
- Check performance: 7-8 tokens/second ‚úÖ

---

## üìã What Was Changed From v0.8 to v1.0

Understanding what changed helps verify the restore worked:

### Architecture Changes
- **OLD**: ONNX Runtime + GPT-2 (653MB)
- **NEW**: llama.cpp + Qwen2-VL-2B-Instruct (940MB, GGUF)

### Key Fixes Applied
1. **Token Limit Fix**: nlen 64 ‚Üí 512 tokens
2. **Submodule Fix**: Hybrid approach (root + external)
3. **CMake Path Fix**: Correct relative path to llama.cpp
4. **Model Format**: ONNX ‚Üí GGUF

### Files Modified (from v0.8)
- `LLamaAndroid.kt:39` - nlen increased to 512
- `CMakeLists.txt:35` - Fixed path to llama.cpp submodule
- `.gitmodules` - Updated submodule configuration
- `LLMManager.kt` - Using llamaAndroid instead of ONNX
- All documentation files updated

---

## üîç Troubleshooting Restore Issues

### Issue: "Tag v1.0-stable not found"

```bash
# List all local tags
git tag -l

# If not found, create it manually
git tag v1.0-stable 61ea16d
```

### Issue: "Submodule changes after restore"

```bash
# Reset submodules to correct state
git submodule update --init --recursive
git submodule update --force --recursive
```

### Issue: "Build fails after restore"

```bash
# Complete clean
rm -rf build
rm -rf app/build
./gradlew clean

# Reset submodules
cd llama.cpp
git checkout master
git pull
cd ..
git submodule update --recursive

# Rebuild
./gradlew assembleDebug
```

### Issue: "Model download fails"

The model is downloaded from Hugging Face on first app launch. If download fails:

1. Check internet connection
2. Try downloading manually:
   ```bash
   wget https://huggingface.co/Qwen/Qwen2-VL-2B-Instruct-GGUF/resolve/main/qwen2.5-vl-2b-instruct-q4_k_m.gguf
   ```
3. Use adb to push to device if needed

---

## üì¶ Backup Metadata

```yaml
Backup:
  version: "1.0"
  commit: "61ea16d"
  tag: "v1.0-stable"
  branch: "claude/ailive-code-review-011CUseJ8kG4zVw12eyx4BsZ"
  date: "2025-11-09"

Architecture:
  backend: "llama.cpp"
  model: "Qwen2-VL-2B-Instruct"
  format: "GGUF"
  quantization: "Q4_K_M"
  size: "940MB"

Performance:
  cpu_tokens_per_second: 7-8
  response_length: 512
  context_length: 2048
  initialization_time: "1-2 seconds"

Status:
  builds: true
  runs: true
  stable: true
  tested: true
  user_confirmed: true
```

---

## üöÄ Next Steps After Restore

If you restore to v1.0 and want to try GPU again:

1. Review what went wrong in `GPU_IMPLEMENTATION_LOG.md` (if it exists)
2. Check GitHub issues for llama.cpp Android OpenCL
3. Consider alternative approaches:
   - Wait for upstream improvements
   - Try different OpenCL configuration
   - Focus on other v1.1 features (streaming, cleanup)
4. Document lessons learned
5. Update VERSION_ROLLOUT_PLAN.md with new timeline

---

## üìû Support

If restore doesn't work:

1. Check this guide carefully
2. Review BUILD_LOG.md for original fixes
3. Check git history: `git log --oneline --graph`
4. Verify submodules: `git submodule status`
5. Try clean slate: Delete everything, fresh clone

---

**Last Updated**: November 9, 2025
**Created By**: Claude (AILive Development Team)
**Restore Tested**: Not yet (backup just created)
**Priority**: CRITICAL - Do not delete this file

---

## ‚ö†Ô∏è IMPORTANT NOTES

1. **Tag is Local**: v1.0-stable tag exists locally but couldn't be pushed to remote due to branch naming restrictions. It still works for local restore.

2. **Submodules**: Remember to update submodules after any git checkout operation.

3. **Build Artifacts**: Don't commit build/ or app/build/ directories. Clean before restore.

4. **Model Files**: Model is not in git. It downloads on first app launch.

5. **Keep This File**: This backup guide should persist across GPU implementation. Don't delete it!

---

**This is your safety net. Version 1.0 is stable and working. Use it wisely! üéØ**
